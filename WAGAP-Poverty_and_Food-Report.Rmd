---
title: "<center>WAGAP Poverty Report: food implications</center>"
author: "<center>Jody O'Connor</center>"
date: "<center>5/14/2021</center>"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.height = 10, fig.width = 10)
```

# Introduction and Agency Overview

Nationwide, Community Action Agencies (CCAs), like wagap, are expected to base their strategies and service priorities on the needs and strengths in their communities. The Results Oriented Management and Accountability (ROMA) framework is a continuous cycle used by CCAs to best meet local needs. Assessing assets and needs in a community is the first phase of the cycle and sets the stage for agency planning and improvement.  

<caption>**Results Oriented Management and Accountability (ROMA) cycle steps:**[^roma-cycle-source]</caption>

<center>![](ROMAcycle.png)</center>

As we embark on our next 3-year cycle, WAGAP partnered with Colibri Consulting to conduct a 2020 Community Needs Assessment for our service area. Input from diverse community members, staff and agency partners regarding community assets and needs was collected and analyzed, as outlined in Appendix A. Methodology.

This assessment targets the following ROMA Next Gen Needs Assessment goals:

- Assess level of poverty within the whole community
- Assess how well the needs of low income individuals and families are currently being met – including what assets and resources the community has
- Identify service barriers that limit the effectiveness of the current service network
- Assess relationships with key partners and stakeholders and identify how to strengthen them
- Build awareness of Community Action and our community agenda
- Develop recommendations that will enhance the community’s ability to address the concerns of low income individuals and families  

***


WAGAP is the Community Action Agency for Skamania and Klickitat Counties. Our mission is to: 

<center>
#### _**Strengthen community by inspiring hope and helping people help themselves.**_    
</center>

We reduce poverty by helping people meet basic human needs and increase their self-sufficiency. With  8 locations across two counties, we generate economic impact by bringing hundreds of thousands of grant dollars into the community annually and providing 35 permanent jobs (plus 10 new temp jobs created in response to COVID-19 related needs). Each year, thousands of people turn to wagap for short-term assistance and long-term solutions to help them take control of their lives and their futures. Programs offering nutrition assistance and food banks, emergency housing and homeless shelter, domestic violence prevention and crime victim services, youth substance abuse prevention, care coordination, home energy and weatherization assistance, on the job training, COVID-19 relief funds, and after school youth programs are some of the ways WAGAP is meeting the promise of Community Action.

[^roma-cycle-source]: ROMA cycle illustration and assessment goals from ROMA Next Gen Needs Assessment guidelines from https://communityactionpartnership.com/publication_toolkit/roma-next-gen-beyond-the-basics/

# Findings

## Community Member Survey Results

```{r}
library(tidyverse)
library(janitor)

# install table formatting package---------------------

# install.packages("flextable")
# https://davidgohel.github.io/flextable/index.html
library(flextable)
# install.packages("gt")
library(gt)

# custom fonts and themes

# install.packages("devtools")
# devtools::install_github("hrbrmstr/hrbrthemes")
library(hrbrthemes)

# add ability to place plots side by side or stacked in knitted doc
# install.packages("devtools")
# devtools::install_github("thomasp85/patchwork")
library(patchwork)
library(scales)

library(extrafont)
font_import(pattern = "Georgia")
windowsFonts(`Georgia` = windowsFont("Georgia"))
windowsFonts(`Georgia` = windowsFont("Arial"))

library(ggtext)

# custom theme 
theme_draft <- function() {
  theme_ipsum_rc(base_family = "Roboto") +
    # ggthemr() +
    # theme_minimal()+
  theme(axis.title.x = element_blank(),
        axis.title.y = element_text(family = "Roboto", hjust = 0),
        axis.text = element_text(family = "Georgia",
                                  size = 15),
        legend.text = element_text(family = "Georgia"),
        panel.grid.minor.y = element_blank(),
        panel.grid.major.x = element_line(color = "orange")) +
  theme(plot.title = element_markdown()) 
}

```

```{r} 
# load data -------------------------------------

wagap <- read_rds("data/WAGAP_tidy_food.rds")


```

### survey respondent demographics

```{r}
wagap %>% 
  summarise(median_household_size = median(household_income, na.rm = TRUE), number_of_responses = n()) %>% 
  knitr::kable()
```

```{r}
race_ethnicity_proportions <- wagap %>% 
  count(race_ethnicity) %>% 
  mutate(pct_of_total_race_ethnicity = n/sum(n)) %>% 
  tabyl(race_ethnicity, pct_of_total_race_ethnicity)
```

```{r} 
wagap %>% 
  group_by(race_ethnicity, is_food_a_challenge) %>% 
  summarise(median_household_size = median(household_size, na.rm = TRUE), number_of_responses = n()) %>% 
  arrange(number_of_responses)
```
### Participant Poverty Status  
#### 50-year County Poverty Trends (ACS data), participant poverty levels plot
#### (to be calculated and plotted later)

## Food Security - who is struggling?
```{r}
wagap %>% 
  count(race_ethnicity, is_food_a_challenge)
```
## The majority of races and ethnicities are Native American, Hispanic and White.
```{r}
wagap %>% 
  drop_na(is_food_a_challenge) %>% 
  filter(race_ethnicity == "White" | race_ethnicity == "Native American/American Indian" | race_ethnicity == "Hispanic/Latino/LatinX") %>% 
  count(is_food_a_challenge, race_ethnicity) %>% 
  arrange(n)
  
```


```{r}
wagap %>% 
  count(race_ethnicity, is_food_a_challenge)

wagap %>% 
  drop_na(race_ethnicity, is_food_a_challenge) %>% 
  tabyl(race_ethnicity, is_food_a_challenge) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting(digits = 0, rounding = "half up", affix_sign=TRUE) %>% 
  adorn_ns() %>% 
  adorn_title()

# flextable() %>%  NOTE: not working so I commented this out
#  theme_zebra()

```

# Food and Ethnicity Summary Chart

```{r fig.height = 6, fig.width = 10}


# total all challenge level responses for labeling purposes (don't forget to ungroup after!)
food_challenges_by_ethnicity <- wagap %>% 
count(race_ethnicity, is_food_a_challenge) %>% 
group_by(is_food_a_challenge) %>% 
mutate(sum_of_all_challenge_level_responses = sum(n)) %>% 
ungroup() %>% 
mutate(pct_of_all_challenge_level_responses = sum_of_all_challenge_level_responses / sum(n))


# re-order challenge levels to show proper order in the chart y-axis:
challenge_level_tib <- tibble(
  challenge_label = c("Yes, a BIG problem!", "Yes, somewhat", "No")
) %>% 
  mutate(challenge_order = row_number())


# NOTE to self: see github.com/gadenbuie/tidyexplain for visual explanation for different join types

food_challenges_by_ethnicity <- food_challenges_by_ethnicity %>% 
  left_join(challenge_level_tib,
            by = c("is_food_a_challenge" = "challenge_label")) %>% 
  mutate(is_food_a_challenge = fct_reorder(is_food_a_challenge,
                                                             challenge_order),
    is_food_a_challenge = fct_rev(is_food_a_challenge)) 


summary_food_plot <- food_challenges_by_ethnicity %>% 
  ggplot(aes(y = is_food_a_challenge,
             x = n,
             fill = race_ethnicity)) +
  geom_col() + 
# NOTE to self: to format the percent that shows up in the label (to make it say "21.9%" instead of the decimal): use scales::percent
  geom_text(aes(label = scales::percent(pct_of_all_challenge_level_responses, accuracy = 0.1),
                 x = sum_of_all_challenge_level_responses + 15),
#  position = position_stack(vjust = .5), THIS LINE NOT NEEDED SINCE LABEL POSITION IS ASSIGNED WITH LABEL ARGUMENT ABOVE
            color = "black", show.legend = FALSE,
            family = "Georgia") +
    scale_fill_brewer(palette = "Set3") +
  labs(title = "<span style = 'color: orange'>Food</span> is a problem for many", x = "number of responses", y = "Is food a challenge in your community?", fill = "") +
  theme_draft() +
  theme(plot.title = element_text(family = "Georgia"),
        axis.title.x = element_text(colour = "orange"),
        legend.text = element_text(family = "Georgia"))

# QUESTION: after creating my custom theme in chunk 2: theme_draft(), I want to change a few of the theme elements for this plot - mostly I want to put the x-axis label back on without changing the custom theme.  But running lines 210-212 result in Error: Only elements of the same class can be merged

summary_food_plot

# NOTE to self: x = sum_of_all_challenge_level_responses added to the aes removed all but one sum_of_all_challenge_level_responses label from each bar in this plot.  Use geom_text instead of geom_label to avoid boxes around labels

```


# food facet plot

```{r fig.height = 6, fig.width = 10, eval=TRUE}

facet_plot_1 <- food_challenges_by_ethnicity %>% 
  ggplot(aes(y = is_food_a_challenge,
             x = n,
             fill = race_ethnicity)) +
  geom_col() + 
  facet_wrap(~race_ethnicity) +
  geom_text(aes(label = n,
                x = ifelse(n < 50, n + 15, n - 25)),
            color = "purple") +
    scale_fill_brewer(palette = "Set2") +
  labs(title = "Food is a problem for many", x = "number of responses", y = "Is food a challenge in your community?", fill = "") +
  theme_bw()

facet_plot_1

# NOTE: theme elements demos: https://henrywang.nl/ggplot2-theme-elements-demonstration/

```


```{r fig.height = 10, fig.width = 11, eval=TRUE}

facet_plot_sans_key <- facet_plot_1 + theme(legend.position = "none")

facet_plot_sans_key / summary_food_plot
```